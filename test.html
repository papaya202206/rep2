<html>
  <head>
    <link rel="stylesheet" href="test.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script>
      var txt1 = "";
      var txt2 = "";
      var num = 0;
      var tmp = [];

      function getCSV(){
          console.info("getCSV")
          var req = new XMLHttpRequest(); // HTTPでファイルを読み込むためのXMLHttpRrequestオブジェクトを生成
          req.open("get", "data.csv", true); // アクセスするファイルを指定
          req.addEventListener('load', {text: req.responseText, handleEvent: convertCSVtoArray});
          req.send(null); // HTTPリクエストの発行

          // レスポンスが返ってきたらconvertCSVtoArray()を呼ぶ	
          // req.onload = function(){
          //   convertCSVtoArray(req.responseText); // 渡されるのは読み込んだCSVデータ
          // }
      }



      function convertCSVtoArray(){ // 読み込んだCSVデータが文字列として渡される
          //var result = []; // 最終的な二次元配列を入れるための配列


          // 各行ごとにカンマで区切った文字列を要素とした二次元配列を生成
          //for(var i=0;i<1;++i){
          var result = tmp[num].split('\t');
          txt1 = result[1];
          document.getElementById('exampleModalLabel').innerText = "No." + result[0] + "/296";
          var row = document.createElement('div');
          row.className='row'

          for(var j=2; j<result.length; j++){
            if (result[j]=='') {
              continue;
            } 
            var col = document.createElement('div');
            col.className='col-md-3'
            // col.innerText = result[i][j];
            // row.appendChild(col)
            var but = document.createElement('button');
            but.className = 'btn btn-info btn-lg';
            but.type = 'button';
            but.onclick=function(){
              document.getElementById('answer').innerText += " " + this.innerText;
              this.className = 'btn btn-secondary btn-lg'
              this.disabled = true;
            };
            but.innerText = result[j];
            col.appendChild(but);
            row.appendChild(col);
          }

          document.getElementById('buttonlist').appendChild(row);//.insertBefore(tr, null);
          //}
      }

      function check(){
        console.log("check");
        if (txt1 == document.getElementById('answer').innerText){
          console.log("same",txt1, document.getElementById('answer').innerText);
          document.getElementById('answer').className = "alert alert-primary";
          document.getElementById('btn-check').className = "btn btn-danger btn-lg d-none";
          document.getElementById('btn-next').className = "btn btn-primary btn-lg";
        }else{
          console.log("different",txt1, document.getElementById('answer').innerText);
          document.getElementById('answer').className = "alert alert-danger";
          document.getElementById('btn-check').className = "btn btn-danger btn-lg";
          document.getElementById('btn-next').className = "btn btn-primary btn-lg d-none";
        }
      }

      function next(){
        document.getElementById('buttonlist').innerHTML = "";
        document.getElementById('answer').innerText = "";
        document.getElementById('answer').className = "alert alert-light";
        document.getElementById('btn-check').className = "btn btn-danger btn-lg";
        document.getElementById('btn-next').className = "btn btn-primary btn-lg d-none";
        num++;
        if(295<num){
            num = 0;
        }
        convertCSVtoArray();
      }

      function clearAnswer(){
        console.log("clear");
        var elems = document.getElementsByClassName('btn btn-secondary');
        while(0<elems.length){
          elems[0].disabled = false;
          elems[0].className = 'btn btn-info btn-lg';
        }

        document.getElementsByClassName('btn btn-secondary').className = 'btn btn-info btn-lg';
        document.getElementById('answer').innerText = "";
        document.getElementById('answer').className = "alert alert-light";
        document.getElementById('btn-check').className = "btn btn-danger btn-lg";
        document.getElementById('btn-next').className = "btn btn-primary btn-lg d-none";
      }
      //document.onload = getCSV();

      function handleFileSelect(evt) {
        var files = evt.target.files;
        var output = [];
        for (var i = 0, f; f = files[i]; i++) {
          var reader = new FileReader();
          reader.onload = (
              function(theFile) {
                  return function(e) {
                      //var span = document.createElement('span');
                      tmp = e.target.result.split("\n"); // 改行を区切り文字として行を要素とした配列を生成
                      convertCSVtoArray();
                      //document.getElementById('list').insertBefore(span, null);
                  };
              })(f);
          reader.readAsText(f);
        }
      }

      document.getElementById('files').addEventListener('change', handleFileSelect, false);
    </script>
  </head>
<body>
  
<button type="button" class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@getbootstrap">Start</button>
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-fullscreen">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="container-fluid" id="buttonlist"></div>
        </div>  
        <hr/>
        <div class="row">
          <div class="alert alert-light" role="alert" id="answer" style="font-size:x-large"></div>
          <button type="button" class="btn btn-primary btn-lg" onclick="clearAnswer()">clear</button>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-light btn-lg" data-bs-dismiss="modal">Close</button>
        <button id="btn-check" type="button" class="btn btn-danger btn-lg" onclick="check()">Check</button>
        <button id="btn-next" type="button" class="btn btn-primary btn-lg d-none" onclick="next()">Next</button>
      </div>
    </div>
  </div>
</div>


<input type="file" id="files" name="files[]" multiple class="btn btn-primary btn-lg"/>
<!-- output id="list"></output -->
<table id="list">
</table>

</body>
</html>


